# Load Average

*Как дата твоего дня рождения, только со смыслом.*

## Как читать и интерпретировать

Показатель LA отображается в выводе утилит top и uptime:

```python
~> uptime
19:23 up 4 days, 9:58, 2 users, load averages: 5,25 5,61 5,09
```

У нас есть три параметры за последние одну, пять и пятнадцать минут, слева на право.

Нормальный показатель LA зависит от количества ядер процессора и для однопроцессорной системы в большинстве случае меньше 1.

Он говорит о том, что у нас нет процессов ожидающих в очереди выполнения. То есть, процессор успевает обработать все процессы находящиеся в очереди за период в 500 тиков.

> Если мы используем все тики за указанный промежуток времени и у нас не будет ожидающих сводного тика процессов, то мы получим загрузку процессора на 100% или load average (LA) равное 1.

**Тик -** промежуток времени, который процессор выделяет на обработку одного процесса. В большинстве современных процессоров равен 10 мс.

**Очередь выполнения** - количество всех процессов, выполняемых в данный момент времени, плюс количество процессов, ожидающих в очереди.

1 не является идеальным значением LA. В большинстве случаем придерживаются показателя 0.7:

- Если среднее значение загрузки постоянно превышает 0.70, следует выяснить причину такого поведения системы во избежании проблем в будущем.
- Если средняя загрузка системы превышает 1.00, необходимо срочно найти причину и устранить ее.
- Если среднее значение загрузки процессора превышает 5.00, у Вас серьезные проблемы. Сервер может подвисать или работать очень медленно.

Стоит помнить, что эти значения верны для систем с одним одноядерным процессором.

> Если загрузка Вашей системы превышает 1.00 на интервале в одну минуту, все в порядке. Если же загрузка превышает 1.00 на пяти- или 15-минутном интервале, Вам следует начать принимать меры. Но, иногда нам нужно чтобы сервер работал «на всю катушку» и в таких случаях load average = 1.00 — то, что доктор прописал.

А что с Hyper-Treading ? Наличие потоков процессора меняет картину LA, поскольку, несмотря на то что производительность процессора не увеличивается, мы получаем еще одну очередь, а значит - еще 500 тиков.

> Прирост производительности от Hyper-threading составляет 15-30%. Второе ядро, хоть и виртуальное, позволяет обрабатывать вычислительные запросы тех процессов, которые в одноядерном варианте стояли бы в очереди.
Непонимание этого момента приводит к тому, что load average ошибочно связывают не с доступностью и достаточностью вычислительных ресурсов, а с производительностью процессора, что приводит к неверным выводам.

То есть, не важно реальные или виртуальные ядра мы используем. С увеличением их количества будет увеличиваться и максимальный нормальный показатель LA, поскольку увеличивается количество процессов, обрабатываемых единовременно. Но, стоит помнит, что для мультипоточных процессоров или виртуальных процессоров при использовании виртуализации у нас может расти показатель нагрузки на CPU, поскольку очереди процессора постоянно полностью загружены.

## Итог

Можно сказать, что LA 1 представляет собой недавнее прошлое (несколько минут назад), LA 5 прошлое (полчаса-час) и LA 15 отдаленное прошлое (несколько часов).

Для примера возьмем такое значение:

```bash
load average: 0.99 0.75 0.35
```

Это говорит о том, что имеет место достаточно кратковременный всплеск нагрузки, при этом вычислительных ресурсов пока достаточно.

А вот значение:

```bash
load average:  0.00 0.36 0.59
```

Говорит о том, что не так давно система испытывала значительные нагрузки в течении довольно продолжительного времени (полчаса-час).

А вот такая картина:

```bash
load average:  4.55 4.22 4.18
```

Для четырехядерного процессора означает, что он работает на пределе своих возможностей в течении длительного времени (несколько часов).

Как видим, load average, несмотря всего на три цифры, способна представить системному администратору огромный пласт информации о фактической загрузке системы на протяжении последних нескольких часов.

Теперь самое время дать ответы на вопросы, поставленные нами в начале статьи: "Много это или мало? Хорошо или плохо? " Для одного ядра мы считаем приемлемыми следующие значения:

- **LA 1** - может превышать 1.00, свидетельствуя о кратковременной пиковой нагрузке на систему.
- **LA 5** - не должен превышать 1.00, в противном случае налицо явный недостаток вычислительных ресурсов.
- **LA 15** - максимальное значение 0.7 - 0.8, но в любом случае не выше 1.0.

Источники:

[CPU Load: когда начинать волноваться](https://habr.com/ru/post/216827/) - все по делу, с простыми примерами. Тот редкий случай когда стоит почитать комменты. Идеально для начала.

[Linux - начинающим. Что такое Load Average и какую информацию он несет](https://interface31.ru/tech_it/2016/06/linux-nachinayushhim-chto-takoe-load-average-i-kakuyu-informaciyu-on-neset.html) - ребята явно хотели утереть нос хабру и, возможно, у них получилось.

[Как считается Load Average](https://habr.com/ru/post/260335/) - перевод отличной статьи с подробным разъяснением принципов подсчёта LA и его значения.
